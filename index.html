<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pakeperro — Menú</title>

  <!-- Tailwind CDN (rápido para CodePen) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* ocultar scrollbars horizontales feos en chips */
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body class="bg-white text-neutral-900">

  <!-- Header pegajoso -->
  <header class="sticky top-0 z-40 backdrop-blur bg-white/80 border-b">
    <div class="max-w-3xl mx-auto px-4 py-3 flex items-center gap-3">
      <div class="w-9 h-9 rounded-xl bg-black text-white flex items-center justify-center text-sm font-bold">PP</div>
      <div class="flex-1">
        <h1 class="text-xl font-bold leading-tight">Pakeperro — Menú</h1>
        <p class="text-xs text-neutral-500">Rápido, fresco y con mucho sabor</p>
      </div>
      <button id="shareBtn" class="px-3 py-1.5 text-sm rounded-xl border hover:bg-neutral-50 active:scale-[.98]">
        Compartir
      </button>
    </div>

    <!-- Search + chips -->
    <div class="max-w-3xl mx-auto px-4 pb-3">
      <input id="searchInput" type="text"
             placeholder="Buscar (ej: perro, tocineta, jugo)"
             class="w-full text-sm px-3 py-2 rounded-xl border outline-none focus:ring focus:ring-neutral-200" />
      <div id="chips" class="mt-2 flex gap-2 overflow-x-auto no-scrollbar py-2"></div>
    </div>
  </header>

  <!-- Aviso de copiado -->
  <div id="toastCopied"
       class="hidden fixed top-4 left-1/2 -translate-x-1/2 z-50 bg-black text-white text-sm px-3 py-1.5 rounded-lg shadow">
    Enlace copiado ✅
  </div>

  <!-- Contenido -->
  <main id="content" class="max-w-3xl mx-auto px-4 py-6"></main>

  <!-- Modal TikTok -->
  <div id="modal" class="hidden fixed inset-0 z-50 items-center justify-center p-4">
    <div class="absolute inset-0 bg-black/60" id="modalBg"></div>
    <div class="relative w-full max-w-md bg-white rounded-2xl shadow-lg overflow-hidden">
      <div class="flex items-center justify-between px-4 py-3 border-b">
        <h3 id="modalTitle" class="text-sm font-semibold truncate pr-4"></h3>
        <button id="modalClose"
                class="px-2 py-1 text-xs rounded-lg border hover:bg-neutral-50"
                aria-label="Cerrar">Cerrar</button>
      </div>
      <div class="p-0">
        <div class="aspect-[9/16] w-full" id="modalBody"></div>
      </div>
      <div class="flex items-center justify-between px-4 py-3 border-t gap-2">
        <span id="modalPrice" class="text-base font-semibold"></span>
        <div class="flex gap-2">
          <a id="modalOpenTikTok"
             class="px-3 py-1.5 text-xs rounded-lg border hover:bg-neutral-50"
             href="#" target="_blank" rel="noreferrer noopener">Abrir TikTok</a>
          <button id="modalShare"
                  class="px-3 py-1.5 text-xs rounded-lg border hover:bg-neutral-50">Compartir</button>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    // =========================
    //   DATOS — EDITA AQUÍ
    // =========================
    const MENU = [
      {
        id: "hd-clasico",
        title: "Perro Clásico",
        description: "Salchicha estilo venezolano, papitas, salsas Pakeperro.",
        price: 6.99,
        category: "hotdogs",
        tiktok: "https://www.tiktok.com/@tiktok/video/7339022333711111111",
      },
      {
        id: "hd-criollo",
        title: "Perro Criollo",
        description: "Salchicha, repollo, cebolla, papitas, queso rallado y salsas.",
        price: 8.49,
        category: "hotdogs",
        tiktok: "",
      },
      {
        id: "burg-arepera",
        title: "Hamburguesa Arepera",
        description: "Carne a la parrilla, queso, tocineta, papitas, reina pepiada.",
        price: 10.99,
        category: "burgers",
        tiktok: "https://www.tiktok.com/@tiktok/video/7339022333711111112",
      },
      {
        id: "beb-maracuya",
        title: "Jugo de Maracuyá",
        description: "Natural y bien frío.",
        price: 3.5,
        category: "drinks",
        tiktok: "",
      },
      {
        id: "extra-queso",
        title: "Extra Queso",
        description: "Porción adicional de queso rallado.",
        price: 1.5,
        category: "extras",
        tiktok: "",
      },
    ];

    const CATEGORIES = [
      { id: "all", label: "Todo" },
      { id: "hotdogs", label: "Hot Dogs" },
      { id: "burgers", label: "Hamburguesas" },
      { id: "drinks", label: "Bebidas" },
      { id: "extras", label: "Extras" },
    ];

    // =========================
    //   UTILIDADES
    // =========================
    const $ = s => document.querySelector(s);
    const $$ = s => document.querySelectorAll(s);

    const slugify = s =>
      s.toLowerCase()
       .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
       .replace(/[^a-z0-9]+/g, "-").replace(/(^-|-$)/g, "");

    function money(n) { return `$${Number(n).toFixed(2)}`; }

    // =========================
    //   ESTADO
    // =========================
    let currentCat = "all";
    let query = "";

    // =========================
    //   RENDER CHIPS
    // =========================
    const chips = $("#chips");
    chips.innerHTML = CATEGORIES.map(c => `
      <button data-cat="${c.id}"
              class="px-3 py-1.5 text-xs rounded-full border whitespace-nowrap hover:bg-neutral-50">
        ${c.label}
      </button>
    `).join("");

    chips.addEventListener("click", (e) => {
      const btn = e.target.closest("button[data-cat]");
      if (!btn) return;
      const id = btn.getAttribute("data-cat");
      if (id === "all") {
        currentCat = "all";
        render();
        return;
      }
      currentCat = id;
      render(true, id); // scroll a esa sección
    });

    // =========================
    //   RENDER LISTA
    // =========================
    const content = $("#content");
    function getFiltered() {
      const q = query.trim().toLowerCase();
      return MENU.filter(m => {
        const inCat = currentCat === "all" || m.category === currentCat;
        const inText = !q ||
          m.title.toLowerCase().includes(q) ||
          m.description.toLowerCase().includes(q);
        return inCat && inText;
      });
    }

    function groupByCategory(list) {
      const map = {};
      for (const item of list) {
        map[item.category] = map[item.category] || [];
        map[item.category].push(item);
      }
      const order = CATEGORIES.map(c => c.id).filter(id => id !== "all");
      return order.map(id => ({ id, items: map[id] || [] }));
    }

    function render(scrollToCat = false, catId = "") {
      const grouped = groupByCategory(getFiltered());
      content.innerHTML = grouped.map(group => `
        <section id="sec-${group.id}" class="mb-8">
          <h2 class="text-lg font-semibold mb-3">
            ${CATEGORIES.find(c => c.id === group.id)?.label || group.id}
          </h2>
          <div class="grid gap-3">
            ${group.items.length === 0
              ? `<p class="text-sm text-neutral-500">No hay items para esta búsqueda.</p>`
              : group.items.map(item => `
                <article class="rounded-2xl border p-4 flex gap-4">
                  <div class="flex-1 min-w-0">
                    <div class="flex items-start justify-between gap-3">
                      <h3 class="text-base font-bold leading-tight truncate">${item.title}</h3>
                      <div class="text-right shrink-0">
                        <div class="text-base font-semibold">${money(item.price)}</div>
                      </div>
                    </div>
                    <p class="text-sm text-neutral-600 mt-1">${item.description}</p>
                    <div class="mt-3 flex gap-2">
                      ${item.tiktok
                        ? `<button class="px-3 py-1.5 text-xs rounded-lg border hover:bg-neutral-50"
                                   data-open="${item.id}">Ver en TikTok</button>`
                        : `<button disabled class="px-3 py-1.5 text-xs rounded-lg border text-neutral-400"
                                   title="Sin video">Sin video</button>`
                      }
                      <a class="px-3 py-1.5 text-xs rounded-lg border hover:bg-neutral-50"
                         href="?item=${item.id}">Enlace directo</a>
                    </div>
                  </div>
                </article>
              `).join("")}
          </div>
        </section>
      `).join("");

      if (scrollToCat && catId) {
        const el = document.getElementById(`sec-${catId}`);
        if (el) el.scrollIntoView({ behavior: "smooth", block: "start" });
      }
    }

    // =========================
    //   BÚSQUEDA
    // =========================
    const searchInput = $("#searchInput");
    searchInput.addEventListener("input", (e) => {
      query = e.target.value || "";
      render();
    });

    // =========================
    //   COMPARTIR
    // =========================
    const toast = $("#toastCopied");
    function showToast() {
      toast.classList.remove("hidden");
      setTimeout(() => toast.classList.add("hidden"), 1500);
    }
    $("#shareBtn").addEventListener("click", async () => {
      const url = window.location.href;
      try {
        if (navigator.share) {
          await navigator.share({ title: "Pakeperro — Menú", text: "Mira el menú de Pakeperro", url });
        } else {
          await navigator.clipboard.writeText(url);
          showToast();
        }
      } catch {
        await navigator.clipboard.writeText(url);
        showToast();
      }
    });

    // =========================
    //   MODAL TIKTOK
    // =========================
    const modal = $("#modal");
    const modalBg = $("#modalBg");
    const modalClose = $("#modalClose");
    const modalBody = $("#modalBody");
    const modalTitle = $("#modalTitle");
    const modalPrice = $("#modalPrice");
    const modalOpenTikTok = $("#modalOpenTikTok");
    const modalShare = $("#modalShare");

    function openModal(item) {
      // actualizar query ?item=
      const url = new URL(window.location.href);
      url.searchParams.set("item", item.id);
      window.history.pushState({}, "", url);

      modalTitle.textContent = item.title;
      modalPrice.textContent = money(item.price);
      modalOpenTikTok.href = item.tiktok || "#";

      modalBody.innerHTML = "";
      if (item.tiktok && /tiktok\.com\//.test(item.tiktok)) {
        const iframe = document.createElement("iframe");
        iframe.src = item.tiktok.replace("/video/", "/embed/v2/");
        iframe.title = `TikTok ${item.title}`;
        iframe.allow = "autoplay; clipboard-write; encrypted-media; picture-in-picture";
        iframe.allowFullscreen = true;
        iframe.className = "w-full h-full";
        modalBody.appendChild(iframe);
      } else {
        modalBody.innerHTML = `<div class="p-4 text-sm text-neutral-600">No hay enlace de TikTok disponible.</div>`;
      }

      modal.classList.remove("hidden");
      modal.setAttribute("aria-modal", "true");
      modal.setAttribute("role", "dialog");
    }

    function closeModal() {
      // limpiar ?item=
      const url = new URL(window.location.href);
      url.searchParams.delete("item");
      window.history.pushState({}, "", url);

      modal.classList.add("hidden");
      modal.removeAttribute("aria-modal");
      modal.removeAttribute("role");
      modalBody.innerHTML = "";
    }

    document.addEventListener("click", (e) => {
      const btn = e.target.closest("[data-open]");
      if (btn) {
        const id = btn.getAttribute("data-open");
        const item = MENU.find(x => x.id === id);
        if (item) openModal(item);
      }
    });
    modalBg.addEventListener("click", closeModal);
    modalClose.addEventListener("click", closeModal);
    document.addEventListener("keydown", (e) => { if (e.key === "Escape") closeModal(); });

    modalShare.addEventListener("click", async () => {
      const itemId = new URL(window.location.href).searchParams.get("item");
      const shareUrl = `${window.location.origin}${window.location.pathname}?item=${itemId}`;
      try {
        if (navigator.share) {
          await navigator.share({ title: "Pakeperro — Menú", url: shareUrl });
        } else {
          await navigator.clipboard.writeText(shareUrl);
          showToast();
        }
      } catch {
        await navigator.clipboard.writeText(shareUrl);
        showToast();
      }
    });

    // Abrir modal si viene ?item= en la URL
    (function openFromQuery() {
      const p = new URLSearchParams(window.location.search);
      const itemId = p.get("item");
      if (!itemId) return;
      const target = MENU.find(x => x.id === itemId || slugify(x.title) === itemId);
      if (target) openModal(target);
    })();

    // primer render
    render();
  </script>
</body>
</html>
